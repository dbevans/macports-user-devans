# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        ebassi graphene 1.5.2
license             Permissive
categories          graphics gnome
maintainers         devans openmaintainer
platforms           darwin
homepage            http://ebassi.github.io/${name}/

description         A thin layer of graphic data types

long_description    ${description}

checksums           rmd160  a67003be5d8587bf82fe9221da522b222757c735 \
                    sha256  e070b8d3bc712b98594ca310be4e3278b7dc7b776e08ab8d476fb57f52aac67b

depends_build       port:pkgconfig \
                    port:meson \
                    port:ninja \
                    port:gtk-doc

depends_lib         path:lib/pkgconfig/glib-2.0.pc:glib2 \
                    port:gobject-introspection

# meson requires builds be in build subdir
worksrcdir          ${distname}/build

patch.dir           ${worksrcpath}/..
patchfiles          patch-meson.build.diff \
                    patch-src-meson.build.diff \
                    patch-src-tests-meson.build.diff

configure.cmd       meson
configure.args      -Denable-gtk-doc=true
configure.post_args ..

build.cmd           ninja
build.target

# DESTDIR must come before ninja command rather than after
destroot.cmd        DESTDIR=${destroot} ninja
destroot.destdir

# meson ninja backend improperly sets shared library install name and rpath
# based on build_dir rather than install_dir
post-destroot {
    set libname ${prefix}/lib/lib${name}-1.0.dylib
    system "install_name_tool -id ${libname} ${destroot}${libname}"
    system "install_name_tool -delete_rpath ${worksrcpath}/src ${destroot}${libname}"
}
