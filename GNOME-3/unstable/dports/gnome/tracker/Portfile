# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                tracker
version             1.1.3
license             GPL-2
set branch          [join [lrange [split ${version} .] 0 1] .]
description         Metadata database, indexer and search tool.
long_description    Tracker is an advanced framework for first class objects \
                    with associated metadata and tags. It provides a one stop \
                    solution for all metadata, tags, shared object databases, \
                    search tools and indexing.

maintainers         gmail.com:juanrgar devans openmaintainer
categories          gnome
platforms           darwin
homepage            https://wiki.gnome.org/Projects/Tracker
master_sites        gnome:sources/${name}/${branch}/

use_xz              yes

checksums           rmd160  220d44c73265f5007e87d6158dc2cc2332ca883a \
                    sha256  4875e4b4e62673c79f08ebc27b261cbfc6db095bd5def5615b97657b0869349a

depends_build       port:pkgconfig \
                    port:intltool

depends_lib         path:lib/pkgconfig/glib-2.0.pc:glib2 \
                    port:gobject-introspection \
                    port:sqlite3 \
                    port:ossp-uuid \
                    port:libgee \
                    port:libgrss \
                    port:vala \
                    port:libunistring \
                    port:libmediaart \
                    port:libexif \
                    port:libiptcdata \
                    port:exempi \
                    port:taglib \
                    port:gtk3 \
                    port:libxml2 \
                    port:poppler \
                    port:libgsf \
                    port:giflib \
                    port:libpng \
                    port:libvorbis \
                    port:flac \
                    port:totem-pl-parser

patchfiles          patch-extract-configure.ac.diff \
                    patch-libtracker-sparql-suffix.diff \
                    patch-module-flags-no-undefined.diff

# update m4/intltool.m4 and autoreconf

pre-configure {
    copy -force ${prefix}/share/aclocal/intltool.m4 ${worksrcpath}/m4
}

use_autoreconf      yes
autoreconf.args     -fvi

configure.args      --disable-schemas-compile \
                    --disable-silent-rules \
                    --disable-functional-tests \
                    --disable-maemo \
                    --enable-journal \
                    --enable-tracker-fts \
                    --disable-unit-tests \
                    --disable-upower \
                    --disable-hal \
                    --disable-network-manager \
                    --enable-libmediaart \
                    --enable-libexif \
                    --enable-libiptcdata \
                    --enable-exempi \
                    --disable-meegotouch \
                    --enable-miner-fs \
                    --enable-miner-rss \
                    --disable-miner-evolution \
                    --disable-miner-thunderbird \
                    --disable-miner-firefox \
                    --disable-nautilus-extension \
                    --enable-taglib \
                    --enable-tracker-needle \
                    --enable-tracker-preferences \
                    --disable-enca \
                    --enable-libxml2 \
                    --enable-unzip-psgz-files \
                    --enable-poppler \
                    --disable-libgxps \
                    --enable-libgsf \
                    --disable-libosinfo \
                    --enable-libgif \
                    --enable-libjpeg \
                    --enable-libtiff \
                    --enable-libpng \
                    --enable-libvorbis \
                    --enable-libflac \
                    --disable-libcue \
                    --enable-abiword \
                    --enable-dvi \
                    --enable-mp3 \
                    --enable-ps \
                    --enable-text \
                    --enable-icon \
                    --enable-playlist

variant enca description {Enable libenca for Cyrillic language detection in MP3s} {
    configure.args-delete   --without-enca
    configure.args-append   --with-enca

    depends_lib-append      port:enca
}

variant gstreamer conflicts libav description {Enable gstreamer generic media extractor backend} {
    configure.args-append   --enable-generic-media-extractor=gstreamer \
                            --with-gstreamer-backend=discoverer

    depends_lib-append      port:gstreamer1 \
                            port:gstreamer1-gst-plugins-base \
                            port:gstreamer1-gst-plugins-good \
                            port:gstreamer1-gst-plugins-bad \
                            port:gstreamer1-gst-plugins-ugly \
                            port:gstreamer1-gst-libav
}

variant libav conflicts gstreamer description {Enable libav generic media extractor backend} {
    configure.args-append   --enable-generic-media-extractor=libav

    depends_lib-append      port:ffmpeg
}

if {![variant_isset libav]} {
    default_variants    +gstreamer
}

post-activate {
    system "${prefix}/bin/glib-compile-schemas ${prefix}/share/glib-2.0/schemas"
}

livecheck.type  gnome-with-unstable
