# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0

name                    ardour2
version                 2.8.16
distname                ardour-${version}
maintainers             devans
license                 GPL-2
categories              audio x11
platforms               darwin
homepage                http://ardour.org/

description             Ardour is a digital audio workstation.

long_description \
                        Ardour is a digital audio workstation. \
                        You can use it to record, edit and mix multi-track audio. \
                        Capabilities include: multichannel recording, non-destructive \
                        editing with unlimited undo/redo, full automation support, \
                        a powerful mixer, unlimited tracks/busses/plugins, timecode \
                        synchronization, and hardware control from surfaces like \
                        the Mackie Control Universal.

use_parallel_build      no
universal_variant       no

use_bzip2               yes

master_sites            file:///Users/devans/macports/distfiles/ardour2
#master_sites            macports:ardour2

checksums               rmd160  a87ef3bdd3f0023a1f1341b902a5525234f5b8fc \
                        sha256  37ee32119ba105fa0883faa7e18c58ecd5276894568da224a554d9ef49075e40

depends_build           port:pkgconfig \
                        port:scons

depends_lib             port:jack \
                        port:gtkmm \
                        port:libgnomecanvas \
                        port:liblrdf \
                        port:boost \
                        port:fftw-3 \
                        port:fftw-3-single \
                        port:libusb-compat \
                        port:liblo \
                        port:aubio

patchfiles              patch-SConstruct.diff \
                        patch-libs-pbd-mountpoint.cc.diff \
                        patch-libs-pbd-pathscanner.cc.diff
#                        patch-gtk2_ardour-SConscript.diff \
#                        patch-gtk2_ardour-main.cc.diff \
#                        patch-gtk2_ardour-nag.cc.diff

pre-patch {
    file copy ${worksrcpath}/SConstruct ${worksrcpath}/SConstruct.orig
}

pre-build {
    reinplace "s%@MP_PREFIX@%${prefix}%g" ${worksrcpath}/SConstruct
    reinplace "s%@MP_CPP@%${configure.cpp}%g" ${worksrcpath}/gtk2_ardour/SConscript
}

use_configure           no

build.cmd               scons
build.target
build.args              PREFIX=${prefix} SYSLIBS=1 FPU_OPTIMIZATION=1 VST=0 AUBIO=1 FREESOUND=1 LV2=0 GTKOSX=0 DIST_TARGET=x86_64

destroot.cmd            scons

# Fix gettext bug on Leopard (and later?); see #19886
destroot.env-append     VERSION_CONTROL=off

variant lv2 description {Add support for LV2 plugins} {
        build.args-delete LV2=0
        build.args-append LV2=1
        depends_lib-append port:slv2
}

variant gcc43 conflicts gcc44 gcc45 gcc46 gcc47 description {build with gcc 4.3} {
    depends_build-append    port:gcc43
    depends_skip_archcheck-append gcc43
    configure.compiler      macports-gcc-4.3
    build.env               CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
    destroot.env            CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
}

variant gcc44 conflicts gcc43 gcc45 gcc46 gcc47 description {build with gcc 4.4} {
    depends_build-append    port:gcc44
    depends_skip_archcheck-append gcc44
    configure.compiler      macports-gcc-4.4
    build.env               CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
    destroot.env            CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
}

variant gcc45 conflicts gcc43 gcc44 gcc46 gcc47 description {build with gcc 4.5} {
    depends_build-append    port:gcc45
    depends_skip_archcheck-append gcc45
    configure.compiler      macports-gcc-4.5
    build.env               CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
    destroot.env            CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
}

variant gcc46 conflicts gcc43 gcc44 gcc45 description {build with gcc 4.6} {
    depends_build-append    port:gcc46
    depends_skip_archcheck-append gcc46
    configure.compiler      macports-gcc-4.6
    build.env               CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
    destroot.env            CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
}

variant gcc47 conflicts gcc43 gcc44 gcc45 gcc46 description {build with gcc 4.7} {
    depends_build-append    port:gcc47
    depends_skip_archcheck-append gcc47
    configure.compiler      macports-gcc-4.7
    build.env               CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
    destroot.env            CC=${configure.cc} CXX=${configure.cxx} CPP=${configure.cpp}
}


if {![variant_isset gcc43] && ![variant_isset gcc44] && ![variant_isset gcc45] && ![variant_isset gcc46]} {
    default_variants +gcc47
}

livecheck.type          regex
livecheck.url           https://community.ardour.org/s/buy_anon
livecheck.regex         "Ardour (\\d+(?:\\.\\d+)*)"
