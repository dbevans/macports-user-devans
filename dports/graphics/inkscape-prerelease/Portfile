# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem      1.0

name            inkscape-prerelease
set dname       inkscape
conflicts       inkscape inkscape-devel inkscape-branched
version         0.91pre4
epoch           1
license         GPL-2 LGPL-2.1
maintainers     devans
categories      graphics gnome
platforms       darwin
description     Unstable development version of Inkscape from \
                recent BZR trunk leading up to release of version 0.91.

long_description \
                Inkscape is an open source SVG editor with \
                capabilities similar to Illustrator, CorelDraw, \
                Visio, etc. Supported SVG features include basic \
                shapes, paths, text, alpha blending, transforms, \
                gradients, node editing, svg-to-png export, \
                grouping, and more.
homepage        http://www.inkscape.org/
master_sites    https://sourceforge.net/projects/inkscape/files/inkscape/${version}/

distname        ${dname}-${version}

checksums       rmd160  b5784b3b2fcf1e2de4c643c9a0e743ff852b31d2 \
                sha256  6e05e4092367ff9e3b22c37fbcf6c3135e0bc800ef8b2a50245d4817c58ab836

depends_build   port:pkgconfig \
                port:autoconf \
                port:automake \
                port:libtool \
                port:intltool \
                path:bin/perl:perl5

depends_lib     port:desktop-file-utils \
                port:popt \
                path:lib/libgc.dylib:boehmgc \
                port:gsl \
                port:gtkmm \
                port:dbus-glib \
                port:lcms2 \
                port:poppler \
                port:boost \
                port:ImageMagick \
                port:libcdr-0.1 \
                port:libexif \
                port:libvisio-0.1 \
                port:libwpg-0.3 \
                port:gtkspell2 \
                port:py27-lxml \
                port:py27-numpy

post-patch {
    xinstall -m 755 ${filespath}/autogen.sh ${worksrcpath}
    reinplace "s|\"python-interpreter\", \"python\"|\"python-interpreter\", \"python2.7\"|g" ${worksrcpath}/src/extension/implementation/script.cpp
    reinplace "s|^#include \"Object.h\"|#include \"${prefix}/include/poppler/Object.h\"|" ${worksrcpath}/src/extension/internal/pdfinput/pdf-parser.h
    reinplace "s|^#include \"Object.h\"|#include \"${prefix}/include/poppler/Object.h\"|" ${worksrcpath}/src/extension/internal/pdfinput/pdf-parser.cpp
}

variant gtk3 description {Enable experimental GTK+ 3 build} {
    depends_lib-delete  port:gtkspell2 \
                        port:gtk2 \
                        port:gtkmm
    depends_lib-append  port:gtkspell3 \
                        port:gtk3 \
                        port:gtkmm3 \
                        port:gdl3

    configure.args-append --enable-gtk3-experimental
}

variant svg2 description {Enable experimental SVG level 2 proposed features} {
    configure.cppflags-append \
                        "-DWITH_MESH -DWITH_CSSBLEND -DWITH_CSSCOMPOSITE -DWITH_SVG2"
}

configure.cmd   ./autogen.sh && ./configure

configure.python \
                ${prefix}/bin/python2.7

configure.args  --without-gnome-vfs \
                --enable-lcms \
                --enable-poppler-cairo \
                --enable-dbusapi \
                --disable-silent-rules \
                --disable-strict-build

configure.cppflags-append \
    -I${worksrcpath}/src/extension/script

if {[string match "*clang*" ${configure.compiler}]} {
    configure.cxxflags-append -std=c++11
}

variant strict description {Enable strict build} {
    configure.args-replace  --disable-strict-build --enable-strict-build
}

default_variants +strict

#
# the following dummy variants are used
# to identify this port's binary dependencies
# based on which variant of gtkmm is used for the build
#

variant x11 conflicts quartz {}
variant quartz conflicts x11 {}

if {![variant_isset quartz]} {
    default_variants +x11
}

if {[variant_isset gtk3]} {
    post-activate {
        system "${prefix}/bin/gtk-update-icon-cache-3.0 -f -t ${prefix}/share/icons/hicolor"
        system "${prefix}/bin/update-desktop-database ${prefix}/share/applications"
    }
} else {
    post-activate {
        system "${prefix}/bin/gtk-update-icon-cache -f -t ${prefix}/share/icons/hicolor"
        system "${prefix}/bin/update-desktop-database ${prefix}/share/applications"
    }
}

livecheck.type  none
